version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 20  # âœ… Node 20 works perfectly with Vite and React 18+
    commands:
      - echo "ğŸ“¦ Installing dependencies..."
      - npm ci || npm install  # Use npm ci if package-lock.json exists

  build:
    commands:
      - echo "ğŸ—ï¸ Building Vite app..."
      - npm run build  # This creates the dist/ folder

  post_build:
    commands:
      - echo "ğŸš€ Uploading build files to S3..."
      # âœ… Sync dist folder to S3 with correct MIME types
      - |
        if [ -d "dist" ]; then
          echo "âœ… Found dist folder. Starting upload..."
          aws s3 sync dist/ s3://docnet-frontend-furcode \
            --delete \
            --cache-control "max-age=31536000" \
            --content-type "text/html" \
            --metadata-directive REPLACE
        else
          echo "âŒ dist folder not found!"
          exit 1
        fi
      - echo "ğŸ‰ Deployment complete!"

artifacts:
  files:
    - '**/*'
  base-directory: dist
  discard-paths: no
